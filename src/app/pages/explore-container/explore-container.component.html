<ion-content class="ion-padding-bottom" fullscreen>
    <ion-refresher #refresher (ionRefresh)="refresh($event)" slot="fixed">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <div class="extended-gradient"></div>

    <ion-toolbar color="transparent" mode="md">
        <ion-title color="clear">BePing</ion-title>
        <ion-buttons slot="start">
            <beping-loading-btn [loading]="isLoading$ | async"></beping-loading-btn>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button (click)="openSettings()">
                <ion-icon name="cog-outline" slot="icon-only"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
    <!--
    <ion-refresher slot="fixed" pullFactor="0.5" pullMin="100" pullMax="200">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>
  -->
    <div>

        <ng-container *ngIf="(currentMemberEntry$ | async) as currentMemberEntry; else noMember">

            <beping-member-name-ranking-info
                    [member]="currentMemberEntry">
            </beping-member-name-ranking-info>
            <beping-card *ngIf="!(isLoggedIn$|async) && ((database|async) === TABT_DATABASES.AFTT)" [marging]="true"
                         [padding]="true">
                <h3 class="ion-text-center ion-padding">{{'DASHBOARD.RANKING_ESTIMATION'|translate}}</h3>
                <ion-button (click)="loginWithAFTT()" class="ion-margin" expand="block">
                    {{'DASHBOARD.LOGIN_TO_AFTT'|translate}}
                </ion-button>
            </beping-card>
            <ng-container *ngIf="currentMemberEntry.ResultEntries?.length > 0; else noResults">
                <beping-member-victory-chart
                        [memberResultEntries]="currentMemberEntry.ResultEntries">
                </beping-member-victory-chart>

                <ng-container *ngIf="numericRankings$|async as numericRankings">
                    <ion-row class="ion-no-padding">
                        <ion-col class="ion-no-padding" size-md="6" size-xs="12">
                            <beping-weekly-elo *ngIf="numericRankings"
                                               [numericRankings]="numericRankings"
                                               [prop]="'elo'"
                                               [label]="'ELO'"
                                               [color]="'#5B8BF7'"

                            ></beping-weekly-elo>
                        </ion-col>
                        <ion-col class="ion-no-padding" size-md="6" size-xs="12">
                            <beping-weekly-elo *ngIf="numericRankings"
                                               [numericRankings]="numericRankings"
                                               [prop]="'bel'"
                                               [label]="'NumÃ©rique'"
                                               [color]="'#ae5bf7'"

                            ></beping-weekly-elo>
                        </ion-col>
                    </ion-row>
                </ng-container>

                <beping-tie-break-played
                        [memberResultEntries]="currentMemberEntry.ResultEntries">
                </beping-tie-break-played>
                <beping-member-latest-matches
                        [matches]="latestMatches$| async">
                </beping-member-latest-matches>

                <beping-member-summary-per-ranking
                        [memberResultEntries]="currentMemberEntry.ResultEntries">
                </beping-member-summary-per-ranking>
            </ng-container>
            <ng-template #noResults>
                <beping-card [padding]="true" class="ion-text-center">

                    <ion-icon class="ion-padding-top" name="information-circle-outline" size="large"
                              slot="start"></ion-icon>
                    <h2 class="ion-padding">
                        {{'DASHBOARD.NO_RESULTS'|translate}}
                        <ng-container *ngIf="(categoriesAvailable$ |async)?.length > 1">
                            {{'DASHBOARD.IN_THIS_CATEGORY'|translate}}
                        </ng-container>
                    </h2>
                </beping-card>
            </ng-template>

        </ng-container>
        <ng-template #noMember>
            <beping-card [marging]="true" [padding]="true">
                <h3 class="ion-text-center ion-padding">
                    {{'DASHBOARD.NO_PLAYER_SELECTED'|translate}}
                </h3>
                <ion-button (click)="chooseMainMember()" class="ion-margin"
                            expand="block">{{'DASHBOARD.CHOOSE_PLAYER'|translate}}
                </ion-button>

            </beping-card>
            <beping-card [marging]="true" [padding]="true">
                <h3 class="ion-text-center ion-padding">
                    {{'DASHBOARD.YOU_CAN_SEE_RESULTS_BOTTOM_NAV'|translate}}
                </h3>
            </beping-card>
        </ng-template>


    </div>
    <ng-container *ngIf="categoriesAvailable$ |async as playercategories">
        <ion-fab *ngIf="playercategories.length > 1" horizontal="end" slot="fixed" vertical="bottom">
            <ion-fab-button>
                <ion-icon [name]="getIcon(currentCategory$ | async)"></ion-icon>
            </ion-fab-button>
            <ion-fab-list side="top">
                <ion-fab-button
                        (click)="categoryClicked(category)"
                        *ngFor="let category of playercategories"
                        [attr.data-desc]="'PLAYER_CATEGORY.' + category | translate"
                        [color]="category === (currentCategory$|async)?'primary': 'light'"
                        [disabled]="category === (currentCategory$|async)">
                    <ion-icon [name]="getIcon(category)"></ion-icon>
                </ion-fab-button>
            </ion-fab-list>
        </ion-fab>

    </ng-container>

</ion-content>
